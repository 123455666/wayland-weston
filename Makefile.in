CFLAGS = @GCC_CFLAGS@

libs = libwayland-server.so libwayland.so
clients = flower gears screenshot terminal
compositors = egl-compositor glx-compositor

all : $(libs) $(compositors) $(clients)

libwayland-server.so :				\
	wayland.o				\
	event-loop.o				\
	connection.o				\
	wayland-util.o

libwayland-server.so : CFLAGS += @FFI_CFLAGS@
libwayland-server.so : LDLIBS += @FFI_LIBS@ -ldl -rdynamic

libwayland.so :					\
	wayland-client.o			\
	connection.o				\
	wayland-util.o

$(libs) :
	gcc -shared $^ $(LDLIBS)  -o $@

$(compositors) $(clients) : CFLAGS += @LIBDRM_CFLAGS@

egl-compositor :				\
	egl-compositor.o			\
	evdev.o					\
	cairo-util.o

egl-compositor : CFLAGS += @EGL_COMPOSITOR_CFLAGS@
egl-compositor : LDLIBS += @EGL_COMPOSITOR_LIBS@ -L. -lwayland-server -rdynamic -lrt

glx-compositor : glx-compositor.o
glx-compositor : CFLAGS += @GL_COMPOSITOR_CFLAGS@
glx-compositor : LDLIBS += @GL_COMPOSITOR_LIBS@ -L. -lwayland-server

flower : flower.o wayland-glib.o cairo-util.o
gears : gears.o window.o wayland-glib.o cairo-util.o
screenshot : screenshot.o wayland-glib.o
terminal : terminal.o window.o wayland-glib.o cairo-util.o

terminal : LDLIBS += -lutil

$(clients) : CFLAGS += @CLIENT_CFLAGS@
$(clients) : LDLIBS += @CLIENT_LIBS@ -L. -lwayland -lrt

clean :
	rm -f $(clients) $(compositors) *.o *.so

Makefile : Makefile.in
	./config.status
